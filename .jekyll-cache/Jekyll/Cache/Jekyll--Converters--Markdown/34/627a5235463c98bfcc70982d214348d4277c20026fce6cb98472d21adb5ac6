I"§<h1 class="no_toc" id="summary">Summary</h1>

<ul id="markdown-toc">
  <li><a href="#ssh-port-forwarding" id="markdown-toc-ssh-port-forwarding">SSH Port Forwarding</a>    <ul>
      <li><a href="#configure-simple-ssh-port-forwarding" id="markdown-toc-configure-simple-ssh-port-forwarding">Configure Simple SSH Port-Forwarding</a>        <ul>
          <li><a href="#1-enable-ip-forwarding" id="markdown-toc-1-enable-ip-forwarding">1. Enable IP Forwarding</a></li>
          <li><a href="#2-forward-traffic-on-port-1111-to-ip-1111-on-port-22" id="markdown-toc-2-forward-traffic-on-port-1111-to-ip-1111-on-port-22">2. Forward traffic on port 1111 to IP 1.1.1.1 on port 22</a></li>
          <li><a href="#3-ask-iptables-to-masquerade" id="markdown-toc-3-ask-iptables-to-masquerade">3. Ask iptables to Masquerade</a></li>
          <li><a href="#4-test" id="markdown-toc-4-test">4. Test</a></li>
          <li><a href="#5-save-iptables-rules" id="markdown-toc-5-save-iptables-rules">5. Save iptables rules</a></li>
          <li><a href="#6-automatically-apply-iptables-rules-at-startup" id="markdown-toc-6-automatically-apply-iptables-rules-at-startup">6. Automatically apply iptables rules at startup</a></li>
        </ul>
      </li>
      <li><a href="#list-prerouting-rules" id="markdown-toc-list-prerouting-rules">List PREROUTING Rules</a></li>
      <li><a href="#delete-nat-rule" id="markdown-toc-delete-nat-rule">Delete NAT Rule</a></li>
    </ul>
  </li>
</ul>

<h1 id="ssh-port-forwarding">SSH Port Forwarding</h1>

<h2 id="configure-simple-ssh-port-forwarding">Configure Simple SSH Port-Forwarding</h2>

<p>Run these commands on the server that will be performing the port forwarding.</p>

<h3 id="1-enable-ip-forwarding">1. Enable IP Forwarding</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo sysctl net.ipv4.ip_forward=1
</code></pre></div></div>

<h3 id="2-forward-traffic-on-port-1111-to-ip-1111-on-port-22">2. Forward traffic on port 1111 to IP 1.1.1.1 on port 22</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo iptables -t nat -A PREROUTING -p tcp --dport 1111 -j DNAT --to-destination 1.1.1.1:22
</code></pre></div></div>

<p>dport = incoming port that will forward the traffic</p>

<p>to-destination = server IP address and port that you are forwarding to</p>

<h3 id="3-ask-iptables-to-masquerade">3. Ask iptables to Masquerade</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> sudo iptables -t nat -A POSTROUTING -j MASQUERADE
</code></pre></div></div>

<h3 id="4-test">4. Test</h3>

<p>From the client PC, SSH to the server that is doing the port forwarding.  If the server doing the port forwarding is 2.2.2.2, then ssh to 2.2.2.2:1111.  You should be connected to 1.1.1.1 via SSH (port 22).</p>

<h3 id="5-save-iptables-rules">5. Save iptables rules</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo sh -c "iptables-save &gt; /etc/iptables.rules"
</code></pre></div></div>

<h3 id="6-automatically-apply-iptables-rules-at-startup">6. Automatically apply iptables rules at startup</h3>

<p>a. Edit the interface the rules apply to by editing /etc/network/interfaces</p>

<p>At the end of the network related lines for that interface, add the line:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pre-up iptables-restore &lt; /etc/iptables.rules
</code></pre></div></div>

<p>b. Edit /etc/sysctl.conf by adding the line net.ipv4.ip_forward = 1.</p>

<p>If you want to keep information from byte and packet counters, use the command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo sh -c "iptables-save -c &gt; /etc/iptables.rules"
</code></pre></div></div>

<h2 id="list-prerouting-rules">List PREROUTING Rules</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo iptables -t nat {--line-numbers} -L
</code></pre></div></div>

<h2 id="delete-nat-rule">Delete NAT Rule</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo iptables -t nat -D PREROUTING [line #]
</code></pre></div></div>

<p>Note: The option ‚Äú-t nat‚Äù are not needed when you want to delete POSTROUTING, INPUT, or OUTPUT rules.</p>
:ET