---
layout: post
tags:
  - articles_rus
  - windows
published: true
---
# Оглавление
{:.no_toc}

* toc
{:toc}

# Использование библиотечных файлов в эксплуатации

Библиотечные файлы были введены в Windows 7 и представляют собой способ просмотра содержимого множества каталогов в одном представлении. Например, библиотека «Изображения» на самом деле содержит местоположения C:\\Users\\User\\Pictures и C:\\Users\\Public\\Pictures. Microsoft реализует это путем создания файлов .library-ms внутри AppData. Файлы библиотеки ms (library-ms) являются XML и строяться по определанной схеме. Большинство типов файлов Microsoft .-ms являются XML. Схему легко найти в Интернете, описание элементов, однако, довольно расплывчато. Ниже приведен пример типичного файла library-ms.

![1]({{ site.baseurl }}/assets/img/posts/Windows-Library-Files/image2011.png){:class="imghalf"}

Этот пример имеет только одно местоположение, но в спецификации сказано, что у нас может быть столько сколько мы хотим. Все библиотеки, которые предоставляет Microsoft, имеют конкретных владельцев с сериализованными местоположениями. Это означает, что вы не можете переместить его с компьютера на компьютер или даже от одного пользователя к другому. Однако все элементы, которые привязывают его к определенной машине/пользователю/местоположению, являются необязательными. Части которые нас интересуют - это SearchConenectionDescription.

<br>
![1]({{ site.baseurl }}/assets/img/posts/Windows-Library-Files/image2012.png){:class="imghalf"}
<br>
								And the template Info element.
<br>
![1]({{ site.baseurl }}/assets/img/posts/Windows-Library-Files/image2013.png){:class="imghalf"}
<br>

The SearchConnectionDescription allows you to choose what paths should be included when conglomerting the files in the library view. In this section we'll just cover the local capabilities of the library files. So, this is useful in many cases. In aiding execution, you can modify the url element of the search connector description path. Pointing the path to a non-existent sub-folder of a junction folder will cause the rendering of the junction folder. This is useful in triggering execution on a link file. This also causes exececution of COM objects (see the article [CLSIDs и Соединительные Папки]({{ site.baseurl }}/rus/articles_rus/CLSIDs-и-папки-соединений/ "CLSIDs и Соединительные Папки")).

 

The templateInfo section allows the user to choose the view explorer will give to the folders/files. In cases where you are using icon rendering (like desktop.ini files), you can change the explorer view from details to icon view.

 

As a tradecraft aspect, you can choose to give the library an icon (folder icon, Recycle Bin icon, etc) by changing the {iconReference} element.

# Remote Capability of Library Files

This section is a follow-on from the first. To understand this capability you might want to read the section on the SearchConnectorDescription. So the remote capabiliity has not yet been tested but is seen to have potential for fingerprinting and attacking machines remotely. The url portion of the SearchConnectorDescription can point at things other than files/folder/known folders (CLSIDs). In fact, the url can be an actual URL or a UNC path. This means that when the library file is rendered (could be placed on removable media or a network share), svchost attempts to find the folder using WebDAV at the network/internet location. I have not proofed out the capability to remotely exploit the machine. However, at a minimum, the OS and IP information is sent with the request to the listening post. The potential here is to use the junction point method on the WebDav server to cause remote execution when the library file is rendered.

