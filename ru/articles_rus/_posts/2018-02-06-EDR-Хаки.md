---
layout: post
categories: articles_rus
tags:
  - articles_rus
  - edr
published: true
---

# Оглавление
{:.no_toc}

* toc
{:toc}

# Рекон
Первым делом определяем есть ли на точке EDR, в этом помогает:

1) Листинг процессов, тут всё понятно
2) Брать цифровую подпись драйверов ядра и сравнение оных с известными сигнатурами вендоров, вот тулза для таких вещей [https://gist.github.com/jthuraisamy/4c4c751df09f83d3620013f5d370d3b9]

Так же при приземлении на точке нужно не только понять что за EDR тут запущена, но и как она сконфигурирована, для этого нужно искать конфиг путь к которому обычно есть в документации к этому продукту, так же нужно оттуда почерпнуть как разшифровать его, если он зашифрован.

# Разбираемся с потоком телеметрии
Итак, обычно бывают 2 сценария
1) Телеметрия записывается где-то в долгой памяти ПК либо кешируется и сервер забирает данные в интервале, либо хранится в оперативке
  В этом случае можно попробовать получить доступ к этим данным, возможно их метоположение будет в документации и возможно они будут защифрованны, а еще сама EDR может тригернуться на попытку получить доступ к данным не из положенного процесса, так что это опасный путь с минами.
  После получения этих данных их предстоит распарсить, либо это будут ProtoBuf [https://developers.google.com/protocol-buffers] с тулзой [https://github.com/mildsunrise/protobuf-inspector] или JSON.
  Так же схемы восстановления данных могут быть найдены онлайн [https://github.com/carbonblack/cbapi/blob/master/server_apis/proto/sensor_events.proto], либо сделать вот так (я не понял как) [http://jackson-t.ca/protobuf-recovery.html], либо в документашке либо вот в проекте OSSEM [https://github.com/hunters-forge/OSSEM/tree/master/data_dictionaries/windows]. Но чет тут я теряюсь и не могу кристально чисто ответить на многие вопросы.
  После сохранения файла за ним приходит сервер и после ответа 200 файл удаляется. Но его дескриптор всё еще доступен и может быть вытащен [https://github.com/marin-m/pbtk] если это протобаф.

2) Телеметрия идет непрерывным потоком на сервер с помощью Веб сокетов.

