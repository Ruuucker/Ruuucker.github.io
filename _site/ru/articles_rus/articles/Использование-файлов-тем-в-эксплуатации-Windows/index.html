<!DOCTYPE html>
<html lang="en">
	
<!-- Basic information about this page -->
<meta charset="UTF-8">
<link rel="icon" type="image/x-icon" href="/assets/img/fav.ico">
<title>
	
		Использование Файлов Тем В Эксплуатации Windows ::
	
	Rucker :: Security Researcher
</title>

<!-- Meta tag looking for mobile devices -->
<meta name="viewport" content="initial-scale=1.5">
<meta name="theme-color" content="#232323">

<!-- Good information about this page -->
<meta name="description" content="Security Researcher">
<meta name="keywords" content="Security, Hacking">
<meta name="author" content="Rucker">

<!-- Style and scripts files -->
<link rel="stylesheet" type="text/css" href="/assets/css/style.css">

<!-- Extra information about this page -->
<link rel="license" type="text/plain" src="/assets/LICENSE">

<!-- Facebook, Linkedin, Reddit and many others Open Graph -->
<meta property="og:site_name" content="Rucker" />
<meta property="og:title" content="Rucker :: Security Researcher" />
<meta property="og:type" content="website" />
<meta property="og:description" content="Security Researcher" />
<meta property="og:url" content="https://ruuucker.github.io" />
<meta property="og:image:type" content="image/png" /> <!-- less than 5mB -->
<meta property="og:image:width" content="600" />
<meta property="og:image:height" content="315" />
<meta property="og:image" content="/assets/img/cover.svg" />
<meta property="og:locale" content="en" />
<meta property="og:locale:alternate" content="ru_RU" />
<meta property="fb:page_id" content="688484114615664" />

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Rucker :: Security Researcher" />
<meta name="twitter:description" content="Security Researcher" />
<meta name="twitter:url" content="https://ruuucker.github.io" />
<meta name="twitter:image" content="/assets/img/cover.svg" />
<meta name="twitter:author" content="" />

<!-- Linkedin OGP cards -->
<meta property="og:image" content="/assets/img/cover.svg" />
<meta property="og:image:width" content="180" />
<meta property="og:image:height" content="110" />

<!-- Google+ OGP cards -->
<meta itemprop="name" content="Rucker :: Security Researcher" />
<meta itemprop="author" content="" />
<meta itemprop="description" content="Security Researcher" />
<meta itemprop="image" content="/assets/img/cover.svg" />


<script type="text/javascript">
	if (window.location.protocol != "https:")
		window.location.href = "https:" + window.location.href.substring(window.location.protocol.length);
</script>

	<body>
		<header>
	<pre class="ascii name">
      ___           ___           ___           ___           ___           ___     
     /\  \         /\__\         /\  \         /\__\         /\  \         /\  \    
    /::\  \       /:/  /        /::\  \       /:/  /        /::\  \       /::\  \   
   /:/\:\  \     /:/  /        /:/\:\  \     /:/__/        /:/\:\  \     /:/\:\  \  
  /::\~\:\  \   /:/  /  ___   /:/  \:\  \   /::\__\____   /::\~\:\  \   /::\~\:\  \ 
 /:/\:\ \:\__\ /:/__/  /\__\ /:/__/ \:\__\ /:/\:::::\__\ /:/\:\ \:\__\ /:/\:\ \:\__\
 \/_|::\/:/  / \:\  \ /:/  / \:\  \  \/__/ \/_|:|~~|~    \:\~\:\ \/__/ \/_|::\/:/  /
    |:|::/  /   \:\  /:/  /   \:\  \          |:|  |      \:\ \:\__\      |:|::/  / 
    |:|\/__/     \:\/:/  /     \:\  \         |:|  |       \:\ \/__/      |:|\/__/  
    |:|  |        \::/  /       \:\__\        |:|  |        \:\__\        |:|  |    
     \|__|         \/__/         \/__/         \|__|         \/__/         \|__|    
       
</pre>
</header>

      	
		 	<nav>
	<ul>
		<li><a href="/ru/#">Главная</a></li>
      		<li><a href="/ru/#articles">Статьи</a></li>
		<!-- <li><a href="/ru/#methods">Методологии</a></li> --!>
		<li><a href="/ru/#cheatsheets">Чит щит</a></li>
     	 	<li><a href="/ru/#tools">Тулзы</a></li>
    	  	<li><a href="/ru/#contact">Ссылки</a></li>
  	    <li><a href="/../">Eng</a></li>
	</ul>
</nav>

      	
		<main>
			<br>
<header>
	<h1>Использование Файлов Тем В Эксплуатации Windows</h1>
</header>

<h1 class="no_toc" id="оглавление">Оглавление</h1>

<ul id="markdown-toc">
  <li><a href="#общая-информация" id="markdown-toc-общая-информация">Общая информация</a></li>
  <li><a href="#примеры" id="markdown-toc-примеры">Примеры</a></li>
  <li><a href="#интересные-характеристики-файла-темы" id="markdown-toc-интересные-характеристики-файла-темы">Интересные характеристики файла темы</a></li>
</ul>

<h1 id="общая-информация">Общая информация</h1>
<p>Файлы тем (.theme) предназначены для изменения внешнего вида вашей машины. Файлы тем имеют формат ini/inf, где файл представляет собой список разделов и свойств. Например, есть строка темы который вы можете использовать в этом файле. В этом разделе вы можете установить отображаемое имя для темы а также фон для входа. Пример раздела темы выглядит следующим образом:</p>

<p><br /><br /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Theme]

; Windows 7 - IDS_THEME_DISPLAYNAME_AERO - Комментарии начинаются с точки с запятой

DisplayName=@%SystemRoot%\System32\themeui.dll,-2013

SetLogonBackground=0
</code></pre></div></div>

<h1 id="примеры">Примеры</h1>

<p>Список вещей которые вы можете установить с помощью файла темы довольно обширен. Вот еще пример файла темы:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>; Copyright © Microsoft Corp.

[Theme]
; Windows 7 - IDS_THEME_DISPLAYNAME_AERO
;DisplayName=@%SystemRoot%\System32\themeui.dll,-2013
DisplayName=@%SystemRoot%\System32\test.dll,-2013
SetLogonBackground=0

; Computer - SHIDI_SERVER
[CLSID\{20D04FE0-3AEA-1069-A2D8-08002B30309D}\DefaultIcon]
DefaultValue=%SystemRoot%\System32\imageres.dll,-109

; UsersFiles - SHIDI_USERFILES
[CLSID\{59031A47-3F72-44A7-89C5-5595FE6B30EE}\DefaultIcon]
DefaultValue=%SystemRoot%\System32\imageres.dll,-123

; Network - SHIDI_MYNETWORK
[CLSID\{F02C1A0D-BE21-4350-88B0-7367FC96EF3C}\DefaultIcon]
DefaultValue=%SystemRoot%\System32\imageres.dll,-25

; Recycle Bin - SHIDI_RECYCLERFULL SHIDI_RECYCLER
[CLSID\{645FF040-5081-101B-9F08-00AA002F954E}\DefaultIcon]
Full=%SystemRoot%\System32\imageres.dll,-54
Empty=%SystemRoot%\System32\imageres.dll,-55

[Control Panel\Cursors]
AppStarting=%SystemRoot%\cursors\aero_working.ani
Arrow=%SystemRoot%\cursors\aero_arrow.cur
Crosshair=
Hand=%SystemRoot%\cursors\aero_link.cur
Help=%SystemRoot%\cursors\aero_helpsel.cur
IBeam=
No=%SystemRoot%\cursors\aero_unavail.cur
NWPen=%SystemRoot%\cursors\aero_pen.cur
SizeAll=%SystemRoot%\cursors\aero_move.cur
SizeNESW=%SystemRoot%\cursors\aero_nesw.cur
SizeNS=%SystemRoot%\cursors\aero_ns.cur
SizeNWSE=%SystemRoot%\cursors\aero_nwse.cur
SizeWE=%SystemRoot%\cursors\aero_ew.cur
UpArrow=%SystemRoot%\cursors\aero_up.cur
Wait=%SystemRoot%\cursors\aero_busy.ani
DefaultValue=Windows Aero
DefaultValue.MUI=@main.cpl,-1020

[Control Panel\Desktop]
Wallpaper=%SystemRoot%\web\wallpaper\Windows\img0.jpg
TileWallpaper=0
WallpaperStyle=10
Pattern=

[VisualStyles]
Path=%ResourceDir%\Themes\Aero\mytheme.msstyles
ColorStyle=NormalColor
Size=NormalSize
ColorizationColor=0x6B74B8FC
Transparency=1

[boot]
SCRNSAVE.EXE=

[MasterThemeSelector]
MTSM=DABJDKT

[Sounds]
; IDS_SCHEME_DEFAULT
SchemeName=@%SystemRoot%\System32\mmres.dll,-800
</code></pre></div></div>

<p>Один из интересных разделов в файле темы - [Slideshow]. Часть слайд-шоу темы позволяет выбирать файлы которые используются в значке файла. Он используется для других вещей, но самая интересное в том что первые три строки списка используются в качестве значков файла темы. Таким образом, в тех случаях когда ваш вектор выполнения кода использует обработку значков/предварительный просмотр файлов (файлы ссылок, файлы шрифтов), файл темы может позволить вам указать до трех других файлов, и обработать их из одного.</p>

<p>Возьмем пример с тремя шрифтами. Есть три шрифта, потому что один использует только Windows 7 x86, другой использует Windows 7 x64, третий использует Windows XP x86. Обычно, чтобы получить полное покрытие вы должны поместить все три файла шрифтов в каталог. Когда цель переходит в каталог содержащий файлы шрифтов, происходит выполнение. Теперь, допустим, у вас есть еще один из «интересных» файлов Microsoft, таких как desktop.ini или library-ms. Вы можете использовать и другие файлы, для указания что ваш файл темы должен быть значком для чего-либо. Для этого примера предположим, что мы делаем его значком чего-то находящегося в корне диска. Мы разместим систему шрифтов, спрятанную на диске. Когда цель попадает в корень диска и отображается значок, обрабатывается и файл темы. Затем, файл темы, который имеет относительные пути к файлам шрифтов, обрабатывает все три шрифта. Таким образом, вы перешли от необходимости использования трех эксплойтов в каталоге в которую нужно заманить цель, к скрытым файлам сохраняя при этом тот же охват.</p>

<p>Вот пример модифицированного файла темы, который будет отображать 3 шрифта при отображении самого себя.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Slideshow]

Interval=1800000

Shuffle=1

ImagesRootPath=MyFolder\temp

Item0Path=MyFolder\temp\font1.fon

Item1Path=MyFolder\temp\font2.fon

Item2Path=MyFolder\temp\font3.fon
</code></pre></div></div>

<h1 id="интересные-характеристики-файла-темы">Интересные характеристики файла темы</h1>

<p>Из экспериментов с файлами тем было выяснено, что вызов ShellExecute для файла темы приведет к изменению темы на значение по умолчанию. Это вызывает открытие окна панели управления, если вы его не скрываете.</p>


		</main>
	</body>
</html>
